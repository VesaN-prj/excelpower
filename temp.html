</DOCTYPE html>

<html>
<head>
<title>OTSIKKO</title>
<meta charset="UTF-8"/>
<style>
    canvas {
        width:650px;
        height:350px;
    }
</style>

</head>

<body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script src="kaavio.js"></script>
<script>

function getAvg(values) {
  if (!Array.isArray(values) || !values.length) {
   return 0;
  } else {
  
  var total = 0;
  
  for(var i = 0; i < values.length; i++) {
      total += Number.parseFloat(values[i]);
  }
  
  return total / values.length;
}
}

var ExcelToJSON = function() {
   
    this.parseExcel = function(file) {
      
      var reader2 = new FileReader();
            reader2.onload = function(e, nimi) {
              var data = e.target.result;
              var workbook = XLSX.read(data, {
                type: 'binary'
              });
              
              workbook.SheetNames.forEach(function(sheetName, nimi) {
                // Here is your object
                var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                var json_object = JSON.stringify(XL_row_object);
                var result = JSON.parse(json_object);
                console.log(json_object);
                jQuery( '#xlx_json' ).val( json_object );
              })
            
            };
            
            reader2.onerror = function(ex) {
              console.log(ex);
            };
            reader2.readAsBinaryString(file[1]);

      var reader = new FileReader();

      

      reader.onload = function(e) {
        var data = e.target.result;
        var workbook = XLSX.read(data, {
          type: 'binary'
        });
        
        workbook.SheetNames.forEach(function(sheetName) {
          // Here is your object
          var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
          var json_object = JSON.stringify(XL_row_object);
          
          var result = JSON.parse(json_object);
          console.log(json_object);
          var json_muiden = JSON.parse(document.getElementById("xlx_json").value)

          
          for(var k in result){
            if(result[k]["Valitse nimesi listalta itsearviointia varten"] != "Response"){
            var arvot = [];
            var tulevaisuus = [];
            var polku = [];
            var viestinta = [];
            var yhteistyo = [];
            var keskinainen = [];
            let tilanne = [];
            var paattaminen = [];
            var jousto = [];
            var energia = [];
            var sisainen = [];
            var suhteet = [];
            
            var div = document.createElement("div");
            div.setAttribute("id", "arvot_ka_" + k);

                for(var i in json_muiden){

                  if(json_muiden[i]["Valitse henkilö jota arvioit"] != "Response"){

                  if(result[k]["Valitse nimesi listalta itsearviointia varten"] == json_muiden[i]["Valitse henkilö jota arvioit"]){
                              var itseArvot = [ result[k]["Arvojen maailma. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"], 
                                                result[k]["__EMPTY"], 
                                                result[k]["__EMPTY_1"],
                                                result[k]["__EMPTY_2"]];
                              arvot.push(getAvg(itseArvot));
                              var itseTulevaisuus = [ result[k]["Tulevaisuuden kuva. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                      result[k]["__EMPTY_3"],
                                                      result[k]["__EMPTY_4"],
                                                      result[k]["__EMPTY_5"]];
                              tulevaisuus.push(getAvg(itseTulevaisuus));
                              var itsePolku = [ result[k]["Polku kulkea. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                result[k]["__EMPTY_6"],
                                                result[k]["__EMPTY_7"],
                                                result[k]["__EMPTY_8"]];
                              polku.push(getAvg(itsePolku));
                              var itseViestinta = [ result[k]["Viestintä. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                    result[k]["__EMPTY_9"],
                                                    result[k]["__EMPTY_10"],
                                                    result[k]["__EMPTY_11"]];
                              viestinta.push(getAvg(itseViestinta));
                              var itseYhteistyo = [ result[k]["Yhteistyö. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                    result[k]["__EMPTY_12"],
                                                    result[k]["__EMPTY_13"],
                                                    result[k]["__EMPTY_14"]];
                              yhteistyo.push(getAvg(itseYhteistyo));
                              var itseKeskinainen = [result[k]["Keskinäinen kannustaminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                    result[k]["__EMPTY_15"],
                                                    result[k]["__EMPTY_16"],
                                                    result[k]["__EMPTY_17"]];
                              keskinainen.push(getAvg(itseKeskinainen));
                              let itseTilanne = [ result[k]["Tilannetaju. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                  result[k]["__EMPTY_18"],
                                                  result[k]["__EMPTY_19"],
                                                  result[k]["__EMPTY_20"]];
                              tilanne.push(getAvg(itseKeskinainen));
                              var itsePaattaminen = [ result[k]["Päättäminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                      result[k]["__EMPTY_21"],
                                                      result[k]["__EMPTY_22"],
                                                      result[k]["__EMPTY_23"]];
                              paattaminen.push(getAvg(itsePaattaminen));
                              var itseJousto = [  result[k]["Joustoa! Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                  result[k]["__EMPTY_24"],
                                                  result[k]["__EMPTY_25"],
                                                  result[k]["__EMPTY_26"]];
                              jousto.push(getAvg(itseJousto));
                              var itseEnergia = [ result[k]["Energia. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                  result[k]["__EMPTY_27"],
                                                  result[k]["__EMPTY_28"],
                                                  result[k]["__EMPTY_29"]];
                              energia.push(getAvg(itseEnergia));
                              var itseSisainen = [  result[k]["Sisäinen eheys. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                    result[k]["__EMPTY_30"],
                                                    result[k]["__EMPTY_31"],
                                                    result[k]["__EMPTY_32"]];
                              sisainen.push(getAvg(itseSisainen));
                              var itseSuhteet = [ result[k]["Ihmissuhteet. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                                  result[k]["__EMPTY_33"],
                                                  result[k]["__EMPTY_34"],
                                                  result[k]["__EMPTY_35"]];
                              suhteet.push(getAvg(itseSuhteet));
                  }
                  }

                  
                }

            document.body.appendChild(div)
            document.getElementById("arvot_ka_" + k).value = new getAvg(arvot);
            console.log("array = " + arvot);
            console.log("avg = " + getAvg(arvot));
            console.log("array = " + tulevaisuus);
            console.log("avg = " + getAvg(tulevaisuus));
            console.log("array = " + polku);
            console.log("avg = " + getAvg(polku));
            console.log("array = " + viestinta);
            console.log("avg = " + getAvg(viestinta));
            console.log("array = " + yhteistyo);
            console.log("avg = " + getAvg(yhteistyo));
            console.log("array = " + keskinainen);
            console.log("avg = " + getAvg(keskinainen));
            console.log("array = " + tilanne);
            console.log("avg = " + getAvg(tilanne));
            console.log("array = " + paattaminen);
            console.log("avg = " + getAvg(paattaminen));
            console.log("array = " + jousto);
            console.log("avg = " + getAvg(jousto));
            console.log("array = " + energia);
            console.log("avg = " + getAvg(energia));
            console.log("array = " + sisainen);
            console.log("avg = " + getAvg(sisainen));
            console.log("array = " + suhteet);
            console.log("avg = " + getAvg(suhteet));
            
            var itseArvot = [ result[k]["Arvojen maailma. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"], 
                              result[k]["__EMPTY"], 
                              result[k]["__EMPTY_1"],
                              result[k]["__EMPTY_2"]];

            var itseTulevaisuus = [ result[k]["Tulevaisuuden kuva. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                    result[k]["__EMPTY_3"],
                                    result[k]["__EMPTY_4"],
                                    result[k]["__EMPTY_5"]];

            var itsePolku = [ result[k]["Polku kulkea. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                              result[k]["__EMPTY_6"],
                              result[k]["__EMPTY_7"],
                              result[k]["__EMPTY_8"]];

            var itseViestinta = [ result[k]["Viestintä. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                  result[k]["__EMPTY_9"],
                                  result[k]["__EMPTY_10"],
                                  result[k]["__EMPTY_11"]];

            var itseYhteistyo = [ result[k]["Yhteistyö. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                  result[k]["__EMPTY_12"],
                                  result[k]["__EMPTY_13"],
                                  result[k]["__EMPTY_14"]];

            var itseKeskinainen = [result[k]["Keskinäinen kannustaminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                  result[k]["__EMPTY_15"],
                                  result[k]["__EMPTY_16"],
                                  result[k]["__EMPTY_17"]];

            let itseTilanne = [ result[k]["Tilannetaju. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                result[k]["__EMPTY_18"],
                                result[k]["__EMPTY_19"],
                                result[k]["__EMPTY_20"]];

            var itsePaattaminen = [ result[k]["Päättäminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                    result[k]["__EMPTY_21"],
                                    result[k]["__EMPTY_22"],
                                    result[k]["__EMPTY_23"]];

            var itseJousto = [  result[k]["Joustoa! Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                result[k]["__EMPTY_24"],
                                result[k]["__EMPTY_25"],
                                result[k]["__EMPTY_26"]];

            var itseEnergia = [ result[k]["Energia. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                result[k]["__EMPTY_27"],
                                result[k]["__EMPTY_28"],
                                result[k]["__EMPTY_29"]];

            var itseSisainen = [  result[k]["Sisäinen eheys. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                  result[k]["__EMPTY_30"],
                                  result[k]["__EMPTY_31"],
                                  result[k]["__EMPTY_32"]];

            var itseSuhteet = [ result[k]["Ihmissuhteet. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                                result[k]["__EMPTY_33"],
                                result[k]["__EMPTY_34"],
                                result[k]["__EMPTY_35"]];
            

            var h2 = document.createElement("h2");
            h2.innerHTML = result[k]["Valitse nimesi listalta itsearviointia varten"];
            document.body.appendChild(h2)
            var canvas = document.createElement("canvas");
            canvas.setAttribute("id", result[k]["Valitse nimesi listalta itsearviointia varten"]);
            document.body.appendChild(canvas);
            var canvas2 = document.createElement("canvas");
            canvas2.setAttribute("id", result[k]["Valitse nimesi listalta itsearviointia varten"] + "_bar");
            document.body.appendChild(canvas2);
            var canvas3 = document.createElement("canvas");
            canvas3.setAttribute("id", result[k]["Valitse nimesi listalta itsearviointia varten"] + "_bar2");
            document.body.appendChild(canvas3);
            var omaDataNimi = result[k]["Valitse nimesi listalta itsearviointia varten"];
            var omaData = [
                           getAvg(itseArvot),
                           getAvg(itseTulevaisuus),
                           getAvg(itsePolku),
                           getAvg(itseViestinta),
                           getAvg(itseYhteistyo),
                           getAvg(itseKeskinainen),
                           getAvg(itseTilanne),
                           getAvg(itsePaattaminen),
                           getAvg(itseJousto),
                           getAvg(itseEnergia),
                           getAvg(itseSisainen),
                           getAvg(itseSisainen)
                          ];
            var muidenData = [
            getAvg(arvot),
            getAvg(tulevaisuus),
            getAvg(polku),
            getAvg(viestinta),
            getAvg(yhteistyo),
            getAvg(keskinainen),
            getAvg(tilanne),
            getAvg(paattaminen),
            getAvg(jousto),
            getAvg(energia),
            getAvg(sisainen),
            getAvg(suhteet)
            ];

            // Chart
            chartRadar(omaDataNimi, omaData, muidenData);
            chartBar(omaDataNimi, omaData, muidenData);
            chartBar2(omaDataNimi, omaData, muidenData);
            // Chart
            
            
            
          
             
    

          }
        }
        })
      
      };
      
      reader.onerror = function(ex) {
        console.log(ex);
      };
      reader.readAsBinaryString(file[0]);
    
    
    };
};

function arvioi() {

    var itse = document.getElementById("ItseArviointi").files; // FileList object
    var muiden = document.getElementById("MuidenArviointi").files;
    var xl2json = new ExcelToJSON();
    var filesArray = [...itse, ...muiden];
    xl2json.parseExcel(filesArray);
}





</script>

<div id="xlx_json"></div>


<form enctype="multipart/form-data">
    <h2>Lataa tähän Excel "itsearviointi":</h2>
    <input id="ItseArviointi" type=file name="files[]">



    <h2>Lataa tähän Excel "muiden arviointi":</h2>
    <input id="MuidenArviointi" type=file name="files[]">
    <button type="button" onclick="arvioi()">Lähetä</button>
</form>


</body>
</html>