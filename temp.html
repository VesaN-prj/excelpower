</DOCTYPE html>

<html>
<head>
<title>OTSIKKO</title>
<meta charset="UTF-8"/>
<style>
    canvas {
        width:200px;
        height:200px;
    }
</style>

</head>

<body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script>

function getAvg(values) {
  if (!Array.isArray(values) || !values.length) {
   return 0;
  } else {
  
  var total = 0;
  
  for(var i = 0; i < values.length; i++) {
      total += Number.parseInt(values[i]);
  }
  
  return total / values.length;
}
}

var ExcelToJSON = function() {
   
    this.parseExcel = function(file) {
      
      var reader2 = new FileReader();
            reader2.onload = function(e, nimi) {
              var data = e.target.result;
              var workbook = XLSX.read(data, {
                type: 'binary'
              });
              
              workbook.SheetNames.forEach(function(sheetName, nimi) {
                // Here is your object
                var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                var json_object = JSON.stringify(XL_row_object);
                jQuery( '#xlx_json' ).val( json_object );
              })
            
            };
            
            reader2.onerror = function(ex) {
              console.log(ex);
            };
            reader2.readAsBinaryString(file[1]);

      var reader = new FileReader();

      

      reader.onload = function(e) {
        var data = e.target.result;
        var workbook = XLSX.read(data, {
          type: 'binary'
        });
        
        workbook.SheetNames.forEach(function(sheetName) {
          // Here is your object
          var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
          var json_object = JSON.stringify(XL_row_object);
          
          var result = JSON.parse(json_object);

          var json_muiden = JSON.parse(document.getElementById("xlx_json").value)

          
          for(var k in result){
            if(result[k]["Valitse nimesi listalta itsearviointia varten"] != "Response"){
            var arvot = [];
            var tulevaisuus = [];
            var polku = [];
            var viestinta = [];
            var yhteistyo = [];
            var keskinainen = [];
            let tilanne = [];
            var paattaminen = [];
            var jousto = [];
            var energia = [];
            var sisainen = [];
            var suhteet = [];
            var nimi = result[k]["Valitse nimesi listalta itsearviointia varten"];
            
            var div = document.createElement("div");
            div.setAttribute("id", "arvot_ka_" + k);

                for(var i in json_muiden){

                  

                  if(result[k]["Valitse nimesi listalta itsearviointia varten"] == json_muiden[i]["Valitse henkilö jota arvioit"]){
                    if(Number.isInteger(parseInt(json_muiden[i]["Arvojen maailma. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    arvot.push(json_muiden[i]["Arvojen maailma. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Tulevaisuuden kuva. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    tulevaisuus.push(json_muiden[i]["Tulevaisuuden kuva. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Polku kulkea. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    polku.push(json_muiden[i]["Polku kulkea. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Viestintä. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    viestinta.push(json_muiden[i]["Viestintä. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Yhteistyö. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    yhteistyo.push(json_muiden[i]["Yhteistyö. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);  
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Keskinäinen kannustaminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    keskinainen.push(json_muiden[i]["Keskinäinen kannustaminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Tilannetaju. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    tilanne.push(json_muiden[i]["Tilannetaju. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Päättäminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    paattaminen.push(json_muiden[i]["Päättäminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Joustoa! Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    jousto.push(json_muiden[i]["Joustoa! Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Energia. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    energia.push(json_muiden[i]["Energia. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Sisäinen eheys. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    sisainen.push(json_muiden[i]["Sisäinen eheys. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                    if(Number.isInteger(parseInt(json_muiden[i]["Ihmissuhteet. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]))){
                    suhteet.push(json_muiden[i]["Ihmissuhteet. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]);
                    }
                  }

                  
                }

            document.body.appendChild(div)
            document.getElementById("arvot_ka_" + k).value = new getAvg(arvot);
            console.log("array = " + arvot);
            console.log("avg = " + getAvg(arvot));
            console.log("array = " + tulevaisuus);
            console.log("avg = " + getAvg(tulevaisuus));
            console.log("array = " + polku);
            console.log("avg = " + getAvg(polku));
            console.log("array = " + viestinta);
            console.log("avg = " + getAvg(viestinta));
            console.log("array = " + yhteistyo);
            console.log("avg = " + getAvg(yhteistyo));
            console.log("array = " + keskinainen);
            console.log("avg = " + getAvg(keskinainen));
            console.log("array = " + tilanne);
            console.log("avg = " + getAvg(tilanne));
            console.log("array = " + paattaminen);
            console.log("avg = " + getAvg(paattaminen));
            console.log("array = " + jousto);
            console.log("avg = " + getAvg(jousto));
            console.log("array = " + energia);
            console.log("avg = " + getAvg(energia));
            console.log("array = " + sisainen);
            console.log("avg = " + getAvg(sisainen));
            console.log("array = " + suhteet);
            console.log("avg = " + getAvg(suhteet));
            
            var h2 = document.createElement("h2");
            h2.innerHTML = result[k]["Valitse nimesi listalta itsearviointia varten"];
            document.body.appendChild(h2)
            var canvas = document.createElement("canvas");
            canvas.setAttribute("id", result[k]["Valitse nimesi listalta itsearviointia varten"]);
            document.body.appendChild(canvas);
            // Chart code starts

            // Chart options
            var chartOptions = {
                responsive: false,
                maintainAspectRatio: true,
                tooltips: {
                    enabled: false
                },
                legend: {
                    onClick: function (lgnd) {
                        lgnd.stopPropagation();
                    },
                    position: 'right'
                },
                animation: {
                    duration: 0
                },
                hover: {
                    mode: null
                },
                scale: {
                    ticks: {
                        beginAtZero: true,
                        max: 10,
                        stepSize: 5
                    }
                }
            };
            // Chart options end

            // Chart data
            var chartLabels = [
                'Arvojen maailma', 
                'Tulevaisuuden kuva',
                'Polku kulkea',
                'Viestintä',
                'Yhteistyö',
                'Keskinäinen kannustaminen',
                'Tilannetaju',
                'Päättäminen',
                'Joustoa!',
                'Energia',
                'Sisäinen eheys',
                'Ihmissuhteet'
            ];

            var chartOwnData = [
                result[k]["Arvojen maailma. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Tulevaisuuden kuva. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Polku kulkea. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Viestintä. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Yhteistyö. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Keskinäinen kannustaminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Tilannetaju. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Päättäminen. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Joustoa! Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Energia. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Sisäinen eheys. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"],
                result[k]["Ihmissuhteet. Arviointiasteikko 1 = ei kuvaa henkilöä ollenkaan, 10 = kuvaa henkilöä täydellisesti"]
            ];

            var chartOthersData = [
                getAvg(arvot),
                getAvg(tulevaisuus),
                getAvg(polku),
                getAvg(viestinta),
                getAvg(yhteistyo),
                getAvg(keskinainen),
                getAvg(tilanne),
                getAvg(paattaminen),
                getAvg(jousto),
                getAvg(energia),
                getAvg(sisainen),
                getAvg(suhteet)
            ];
            // Chart data ends

            var chartData = {
                labels: chartLabels,
                datasets: [{
                        backgroundColor: '#ff6384',
                        borderColor: '#ff6384',
                        data: chartOwnData,
                        label: 'Oma arvio',
                        fill: false
                    }, {
                        backgroundColor: '#36a2eb',
                        borderColor: '#36a2eb',
                        data: chartOthersData,
                        label: 'Muiden arvio',
                        fill: false
                    }]
            };

            var ctx = document.getElementById(result[k]["Valitse nimesi listalta itsearviointia varten"]);

            var myRadarChart = new Chart(ctx, {
                type: 'radar',
                data: chartData,
                options: chartOptions
            });
            // Chart code ends
            
            
            
          
             
    

          }
        }
        })
      
      };
      
      reader.onerror = function(ex) {
        console.log(ex);
      };
      reader.readAsBinaryString(file[0]);
    
    
    };
};

function arvioi() {

    var itse = document.getElementById("ItseArviointi").files; // FileList object
    var muiden = document.getElementById("MuidenArviointi").files;
    var xl2json = new ExcelToJSON();
    var filesArray = [...itse, ...muiden];
    xl2json.parseExcel(filesArray);
}





</script>

<div id="xlx_json"></div>


<form enctype="multipart/form-data">
    <h2>Lataa tähän Excel "itsearviointi":</h2>
    <input id="ItseArviointi" type=file name="files[]">



    <h2>Lataa tähän Excel "muiden arviointi":</h2>
    <input id="MuidenArviointi" type=file name="files[]">
    <button type="button" onclick="arvioi()">Lähetä</button>
</form>


</body>
</html>